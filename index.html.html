import React, { useState, useEffect, useRef } from 'react';

// CommentBox.io Integration Component
const CommentBoxComponent = () => {
  const commentBoxRef = useRef(null);
  const removeCommentBoxRef = useRef(null);

  useEffect(() => {
    // Load CommentBox.io script
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/commentbox.io/dist/commentBox.min.js';
    script.async = true;
    
    script.onload = () => {
      if (window.commentBox && commentBoxRef.current) {
        removeCommentBoxRef.current = window.commentBox('5710196022181888-proj', {
          createBoxUrl: function(boxId, pageLocation) {
            pageLocation.hash = '';
            pageLocation.search = '';
            return pageLocation.href;
          }
        });
      }
    };
    
    document.head.appendChild(script);

    return () => {
      if (removeCommentBoxRef.current) {
        removeCommentBoxRef.current();
      }
      // Clean up script
      const existingScript = document.querySelector('script[src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"]');
      if (existingScript) {
        document.head.removeChild(existingScript);
      }
    };
  }, []);

  return <div className="commentbox" ref={commentBoxRef} />;
};

const ModsSwitcher = () => {
  const [downloadProgress, setDownloadProgress] = useState(0);
  const [isDownloading, setIsDownloading] = useState(false);
  const [downloadStatus, setDownloadStatus] = useState('');
  const [showNotification, setShowNotification] = useState(false);
  const [showAbout, setShowAbout] = useState(false);

  const startDownload = (platform) => {
    setShowNotification(true);
    setIsDownloading(true);
    setDownloadProgress(0);
    setDownloadStatus('Preparing Mods Switcher download...');
    
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress > 100) progress = 100;
      
      setDownloadProgress(progress);
      
      if (progress < 30) {
        setDownloadStatus('Initializing download...');
      } else if (progress < 60) {
        setDownloadStatus('Downloading Mods Switcher...');
      } else if (progress < 90) {
        setDownloadStatus('Finalizing installation package...');
      } else if (progress >= 100) {
        setDownloadStatus('✅ Download completed successfully!');
        clearInterval(interval);
        
        // Create and trigger download of a dummy file
        const link = document.createElement('a');
        link.href = 'data:text/plain;charset=utf-8,ModsSwitcher%20-%20Placeholder%20File';
        link.download = 'ModsSwitcher.rar';
        link.click();
        
        setTimeout(() => {
          setIsDownloading(false);
          setDownloadProgress(0);
          setDownloadStatus('');
        }, 3000);
      }
    }, 100);
    
    setTimeout(() => setShowNotification(false), 3000);
  };

  const scrollToSection = (sectionId) => {
    if (sectionId === 'about') {
      setShowAbout(true);
    }
    setTimeout(() => {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 100);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600">
      {/* Download Notification */}
      {showNotification && (
        <div className="fixed top-24 right-5 bg-gradient-to-r from-green-500 to-emerald-500 text-white p-4 rounded-lg shadow-2xl z-50 animate-slide-in-right">
          <div className="flex items-center gap-3">
            <span className="text-2xl">🎉</span>
            <div>
              <div className="font-bold">Download Started!</div>
              <div className="text-sm opacity-90">Thank you for downloading</div>
            </div>
          </div>
        </div>
      )}

      {/* Header */}
      <header className="fixed top-0 w-full bg-white bg-opacity-10 backdrop-blur-lg border-b border-white border-opacity-20 z-40">
        <nav className="max-w-6xl mx-auto px-5 py-4 flex justify-between items-center">
          <a href="#" className="text-2xl font-bold text-white no-underline">
            🎮 Mods Switcher
          </a>
          <ul className="hidden md:flex list-none gap-8">
            <li><a href="#features" onClick={(e) => { e.preventDefault(); scrollToSection('features'); }} className="text-white no-underline hover:opacity-80 transition-opacity">Features</a></li>
            <li><a href="#download" onClick={(e) => { e.preventDefault(); scrollToSection('download'); }} className="text-white no-underline hover:opacity-80 transition-opacity">Download</a></li>
            <li><a href="https://ko-fi.com/ehssandev#checkoutModal" target="_blank" className="text-white no-underline hover:opacity-80 transition-opacity">Donation</a></li>
            <li><a href="#about" onClick={(e) => { e.preventDefault(); scrollToSection('about'); }} className="text-white no-underline hover:opacity-80 transition-opacity">About</a></li>
          </ul>
        </nav>
      </header>

      {/* Main Content */}
      <main className="pt-20">
        {/* Hero Section */}
        <section className="text-center py-16 text-white max-w-6xl mx-auto px-5">
          <h1 className="text-5xl md:text-6xl font-bold mb-4 drop-shadow-lg">
            Mods Switcher for GTA5/RDR2
          </h1>
          <p className="text-xl mb-8 opacity-90 max-w-2xl mx-auto">
            Simply turn your mods on or off for Grand Theft Auto 5 and Red Dead Redemption 2. No complicated setup - just easy mod management with the click of a button.
          </p>
        </section>

        <div className="max-w-6xl mx-auto px-5">
          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 text-center text-white border border-white border-opacity-20 hover:transform hover:-translate-y-1 transition-all shadow-xl">
              <span className="block text-4xl font-bold text-green-300 mb-2">+15,000</span>
              <span className="text-lg opacity-90">Total Downloads</span>
            </div>
            <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 text-center text-white border border-white border-opacity-20 hover:transform hover:-translate-y-1 transition-all">
              <span className="block text-4xl font-bold mb-2">9.70MB</span>
              <span className="text-lg opacity-90">File Size</span>
            </div>
          </div>

          {/* Download Section */}
          <section id="download" className="bg-white rounded-3xl p-12 mb-12 text-center shadow-2xl">
            <h2 className="text-3xl font-bold mb-4 text-gray-800">Download Mods Switcher</h2>
            <p className="text-lg text-gray-600 mb-8">Simple mod management for GTA5 and RDR2. Turn your mods on and off with just one click!</p>
            
            {isDownloading && (
              <div className="w-full h-5 bg-gray-200 rounded-full overflow-hidden mb-6">
                <div 
                  className="h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all duration-300"
                  style={{ width: `${downloadProgress}%` }}
                ></div>
              </div>
            )}
            
            {!isDownloading ? (
              <button 
                onClick={() => startDownload('windows')}
                className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-12 py-4 text-xl rounded-full border-none cursor-pointer transition-all hover:transform hover:-translate-y-1 hover:shadow-2xl shadow-lg animate-pulse"
              >
                🪟 Download Mods Switcher
              </button>
            ) : (
              <div className="text-indigo-600 font-bold text-lg">{downloadStatus}</div>
            )}
          </section>

          {/* System Requirements */}
          <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-8 mb-12 border border-white border-opacity-20">
            <h3 className="text-2xl font-bold text-white mb-6">📋 System Requirements</h3>
            <div className="bg-white bg-opacity-20 p-6 rounded-xl">
              <div className="text-white">
                <strong>Windows</strong><br />
                Windows 10 or later<br />
                GTA5 and/or RDR2 installed
              </div>
            </div>
          </div>

          {/* Features */}
          <section id="features" className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            {[
              { icon: '🎮', title: 'Multi-Game Support', desc: 'Works with both GTA5 and RDR2. One simple tool for both games.' },
              { icon: '🔘', title: 'Simple On/Off Toggle', desc: 'Turn your mods on or off with a single click. No complicated configurations needed.' },
              { icon: '⚡', title: 'Instant Results', desc: 'Changes take effect immediately. No restart required, just toggle and play.' },
              { icon: '🎯', title: 'Easy to Use', desc: 'Clean, simple interface. Perfect for beginners who just want mods on or off.' },
              { icon: '💾', title: 'Safe Operation', desc: 'Never permanently deletes your mods. Just enables or disables them safely.' },
              { icon: '🚀', title: 'Lightweight', desc: 'Tiny footprint, minimal system resources. Just does what you need, nothing more.' }
            ].map((feature, index) => (
              <div key={index} className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 text-center text-white border border-white border-opacity-20 hover:transform hover:-translate-y-2 transition-all">
                <div className="text-5xl mb-4">{feature.icon}</div>
                <h3 className="text-xl font-bold mb-3">{feature.title}</h3>
                <p className="opacity-90">{feature.desc}</p>
              </div>
            ))}
          </section>

          {/* About Section */}
          {showAbout && (
            <section id="about" className="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-12 mb-12 text-white border border-white border-opacity-20">
              <h2 className="text-4xl font-bold mb-8 text-center">About Mods Switcher</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {[
                  { title: '🎯 What is Mods Switcher?', content: 'Mods Switcher is a lightweight utility designed specifically for GTA5 and RDR2 players who want hassle-free mod management. Instead of manually renaming files or moving folders, our tool provides a simple on/off switch for your entire mod collection.' },
                  { title: '🔧 How it Works', content: 'The tool works by temporarily renaming your mod files when you want to disable them, and restoring their original names when you want to enable them. This method is completely safe and reversible - your mods are never deleted or permanently modified.' },
                  { title: '🎮 Perfect for Online Play', content: 'Want to switch between modded single-player and clean online gameplay? Mods Switcher makes this transition seamless. Disable all mods with one click before going online, then re-enable them instantly when you\'re back to single-player.' },
                  { title: '💡 Why Choose Our Tool?', content: 'Unlike complex mod managers with dozens of features you don\'t need, Mods Switcher focuses on doing one thing perfectly: turning your mods on or off quickly and safely. No learning curve, no complicated setup - just install and use.' },
                  { title: '🛡️ Safety First', content: 'We understand how valuable your mod collection is. That\'s why our tool uses non-destructive methods to manage your mods. Even if something goes wrong, your original mod files remain intact and can be easily restored.' },
                  { title: '🚀 Future Updates', content: 'We\'re constantly working to improve Mods Switcher based on user feedback. Future updates may include individual mod selection, backup creation, and support for additional games. Stay tuned!' }
                ].map((item, index) => (
                  <div key={index} className="bg-white bg-opacity-10 p-6 rounded-2xl border border-white border-opacity-20">
                    <h3 className="text-xl font-bold mb-3">{item.title}</h3>
                    <p className="opacity-90 leading-relaxed">{item.content}</p>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* Comments Section with CommentBox.io */}
          <section className="bg-white rounded-3xl p-12 mb-12 shadow-2xl">
            <h2 className="text-3xl font-bold text-gray-800 mb-8 text-center">💬 User Comments & Feedback</h2>
            <CommentBoxComponent />
          </section>
        </div>
      </main>

      {/* Footer */}
      <footer className="bg-black bg-opacity-20 text-white text-center py-8 mt-12">
        <div className="max-w-6xl mx-auto px-5">
          <p>&copy; 2025 Mods Switcher for GTA5/RDR2. All rights reserved. | <a href="#" className="text-white hover:opacity-80">Privacy Policy</a> | <a href="#" className="text-white hover:opacity-80">Terms of Service</a></p>
        </div>
      </footer>

      <style jsx>{`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        .animate-slide-in-right {
          animation: slide-in-right 0.5s ease-out;
        }
      `}</style>
    </div>
  );
};

export default ModsSwitcher;
